# Rust-based Ext webserver
[![Build Status](https://travis-ci.com/SpectralSequences/rust_webserver.svg?branch=master)](https://travis-ci.com/SpectralSequences/rust_webserver)

There are three parts to this code.
## Spectral Sequence Editor
The first part is a spectral sequence editor. It takes as an input a Steenrod
module, and computes the E_2 page using the resolver. One can then add
differentials and mark classes as permanent, which can be propagated via the
Leibniz rule.

This is managed by a rust backend and uses a websocket to communicate to the
web frontend for display.

To build and run, simply run
```console
$ cargo run --release
```
and then navigate to `http://localhost:8080/`.

The source files are located in `interface/` and `src/`.

## Spectral Sequence Editor (without backend)
This is a variation of the previous version, where the rust backend is compiled
to wasm so that everything runs on the browser. This is more convenient for
distribution but is slower. A live version is available at
[https://spectralsequences.github.io/sseq/](https://spectralsequences.github.io/sseq/).

To setup the build environment, run
```console
 $ make setup-wasm
```

Afterwards, build and serve with
```console
 $ make wasm
 $ make serve-wasm
```
This serves the website at `localhost:[port]`. The `[port]` argument is optional and defaults to `8000`.

The final command merely serves the directory `dist/`, which you may serve with
your favorite alternative webserver. There are two points to take note if
you want to serve the directory yourself.

1. By default, most http servers do not serve `.wasm` files with the correct
   MIME type. For example, you need to add the following line to `.htaccess`
   for Apache:
```
AddType application/wasm .wasm
```

2. During compilation, the `dist/` directory is deleted and then re-created, so
   the actual directory changes every time you compile.

The relevant source files are in `wasm/`.

## Calculation Display
This displays a completed computation, with notes for each of the actions. This
is generated by one of the two previous parts. The interface is not very well
developed, but see https://dec41.user.srcf.net/includes/sseq/tmf/ for an
example of the result.

This uses a fork of https://github.com/usablica/intro.js for the introduction.

The relevant files are in `display/`.

## Save files
Save files are filees produced by the "Save" button in the editor. This is a list of actions performed in the spectral sequence calculation. This can be loaded via the "Load History" button in the homepage.

The format is pretty simple. Each line is a JSON encoding the action, and these are executed in order. The allowed actions are not documented but it should be simple to figure out from examples.

One can manually reorganize the calculation by moving the rows around. Lines are ignored if they are empty or start with `//`. These can be used to help organizing the calculation.

One can add annotations to the lines, which affects how it is displayed in Calculation Display (but *not* the editor). Adding `"skip":true` means this will be grouped with the next item. Adding `"short-note":"Lorem ipsum"` and `"note":"Lorem ipsum"` will add notes to the corresponding action. Note that if several actions are grouped, only the notes of the first action will be displayed.

## compressor
This is a utility for further compressing the history file constructed by the
previous interface. It is not very well polished. To use it, save the file to
compress as `compressor/old.hist`, and then run `cargo run --release`. The
compressed file will be saved at `compressor/new.hist`.

This program is multithreaded, and to change the number of threads used, edit
the `NUM_THREAD` variable in `compressor/src/main.rs`.
